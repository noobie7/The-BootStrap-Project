{% extends 'base.html' %}
{% block title %} 
    <title>
        Two
    </title>
{% endblock title %}
{% block content %} 
    <div class="container p-3 m-3 ">
        <canvas class="p-5 canvas-fluid"  id="myChart" style="height: 200vh; width: 200vw;"></canvas>
    </div>
    
  



{% endblock content %}

{% block script %}

<script>

  printChart('line');
  async function printChart( chartType ) {
    let myChart = document.getElementById('myChart').getContext('2d');
    const data = await getdata();
    let massPopChart = new Chart(myChart, {
      type: chartType, // bar, horizontalBar, pie, line, doughnut, radar, polarArea
      data:{
        labels:['Boston', 'Worcester', 'Springfield', 'Lowell', 'Cambridge', 'New Bedford'],
        datasets:[{
          label: data.xs,
          data: data.ys,
          //backgroundColor:'green',
          backgroundColor:[],
          borderWidth:1,
          borderColor:'white',
          hoverBorderWidth:3,
          hoverBorderColor:'grey'
        }]
      },
      options:{
        title:{
          display:true,
          text:'Largest Cities In Massachusetts',
          fontSize:25
        },
        legend:{
          display:true,
          position:'right',
          labels:{
            fontColor:'#000'
          }
        },
        layout:{
          padding:{
            left:50,
            right:50,
            bottom:0,
            top:0
          }
        },
        tooltips:{
          enabled:true
        }
      }
    });
  }
  async function getdata(){
    const xs = [];
    const ys = [];
    const response = await fetch("https://api.openweathermap.org/data/2.5/weather?q=New York&appid=b8fbb0cd1cba6603b3215309720fa9eb");
    const data = await response.text();
    console.log(response);
    const table = data.split('\n').slice(1);
    table.forEach(row => {
      const columns = row.split(',');
      const year = columns[0];
      xs.push(year);
      const temp = columns[1];
      ys.push(parseInt(temp) + 14);
    });
    return {xs, ys};
  }

  
  
</script>
{% endblock script %} 